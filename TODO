Remove duplicate code (TODO)
Automated tests
Break out JS better
